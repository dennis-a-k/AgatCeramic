document.addEventListener("DOMContentLoaded",function(){S(),b()});function S(){document.querySelectorAll(".add-cart").forEach(c=>{c.addEventListener("click",function(){var d;const e=this.dataset.productId,r=((d=this.closest(".pro-details-quality"))==null?void 0:d.querySelector(".cart-plus-minus-box"))||document.querySelector(".cart-plus-minus-box"),u=r?r.value:1;v(e,u)})}),document.querySelectorAll(".cart-plus-minus-box").forEach(c=>{c.closest(".table-content")&&c.addEventListener("change",function(){const e=this.closest("tr").dataset.productId;a(e,this.value)})}),document.querySelectorAll(".product-remove a").forEach(c=>{c.addEventListener("click",function(e){e.preventDefault();const r=this.closest("tr").dataset.productId;C(r)})})}function b(){document.querySelectorAll(".cart-plus-minus").forEach(o=>{const t=o.querySelector(".cart-plus-minus-box");if(!t)return;const c=document.createElement("div"),e=document.createElement("div");c.className="dec qtybutton",c.textContent="-",e.className="inc qtybutton",e.textContent="+",t.parentNode.insertBefore(c,t),t.parentNode.appendChild(e),c.addEventListener("click",()=>s(t,-1)),e.addEventListener("click",()=>s(t,1))})}function s(n,o){let t=parseInt(n.value);if(t=Math.max(1,t+o),n.value=t,n.closest(".table-content")){const c=n.closest("tr").dataset.productId;a(c,t)}}function v(n,o){fetch("/cart/add",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({product_id:n,quantity:o})}).then(t=>t.json()).then(t=>{l(t.message),T(t.cart_count)}).catch(t=>console.error("Ошибка:",t))}function a(n,o){fetch("/cart/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({product_id:n,quantity:o})}).then(t=>t.json()).then(t=>{m(t.total)}).catch(t=>console.error("Ошибка:",t))}function C(n){fetch("/cart/remove",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({product_id:n})}).then(o=>o.json()).then(o=>{const t=document.querySelector(`tr[data-product-id="${n}"]`);t&&t.remove(),m(o.total),l(o.message)}).catch(o=>console.error("Ошибка:",o))}function l(n){const o=document.createElement("div");o.className="cart-notification",o.textContent=n,document.body.appendChild(o),setTimeout(()=>{o.remove()},3e3)}function T(n){const o=document.querySelector(".cart-count");o&&(o.textContent=n)}function m(n){const o=document.querySelector(".product-subtotal");o&&(o.textContent=`${n} ₽`)}document.addEventListener("DOMContentLoaded",function(){const n=window.location.origin;document.querySelectorAll(".quickview").forEach(t=>{t.addEventListener("click",function(){const c=this.getAttribute("data-id");document.querySelector("#modalProduct .modal-body h2").innerText="Загрузка...",document.querySelector("#modalProduct .modal-body .new-price").innerText="",document.querySelector("#modalProduct .modal-body .swiper-container .swiper-wrapper").innerHTML="",fetch(`${n}/api/product/${c}`).then(e=>{if(!e.ok)throw new Error("Ошибка загрузки данных");return e.json()}).then(e=>{const r=e.title||"---",u=e.price||"---",d=e.sku||"---",p=e.unit==="шт"?"<span>шт.</span>":"<span>м<sup>2</sup></span>",y=e.collection?e.collection.title:"---",h=e.brand?e.brand.title:"---",f=e.description||"---",q=e.images&&e.images.length>0?e.images:[{title:null}];document.querySelector("#modalProduct .modal-body h2").innerText=r,document.querySelector("#modalProduct .modal-body .new-price").innerText=`${u} ₽`,document.querySelector("#modalProduct .modal-body .new-sku").innerText=d,document.querySelector("#modalProduct .modal-body .new-unit").innerHTML=p,document.querySelector("#modalProduct .modal-body .new-collection").innerText=y,document.querySelector("#modalProduct .modal-body .new-brand").innerText=h,document.querySelector("#modalProduct .modal-body .new-description").innerText=f,document.querySelector("#modalProduct .modal-body .swiper-container .swiper-wrapper").innerHTML=q.map(i=>`<div class="swiper-slide" style="border: none;"><img class="img-responsive m-auto" src="${i.title?`${n}/storage/images/${i.title}`:`${n}/assets/images/stock/stock-image.png`}" alt="${i.title?i.title:"Изображение по умолчанию"}"></div>`).join("")}).catch(e=>{console.error(e),document.querySelector("#modalProduct .modal-body h2").innerText="Ошибка загрузки данных"})})})});
