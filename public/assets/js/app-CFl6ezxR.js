document.addEventListener("DOMContentLoaded",function(){v(),C()});function v(){document.querySelectorAll(".add-cart").forEach(c=>{c.addEventListener("click",function(){var d;const o=this.dataset.productId,r=((d=this.closest(".pro-details-quality"))==null?void 0:d.querySelector(".cart-plus-minus-box"))||document.querySelector(".cart-plus-minus-box"),i=r?r.value:1;T(o,i)})}),document.querySelectorAll(".cart-plus-minus-box").forEach(c=>{c.closest(".table-content")&&c.addEventListener("change",function(){const o=this.closest("tr").dataset.productId;a(o,this.value)})}),document.querySelectorAll(".product-remove a").forEach(c=>{c.addEventListener("click",function(o){o.preventDefault();const r=this.closest("tr").dataset.productId;w(r)})})}function C(){document.querySelectorAll(".cart-plus-minus").forEach(e=>{const t=e.querySelector(".cart-plus-minus-box");if(!t)return;const c=document.createElement("div"),o=document.createElement("div");c.className="dec qtybutton",c.textContent="-",o.className="inc qtybutton",o.textContent="+",t.parentNode.insertBefore(c,t),t.parentNode.appendChild(o),c.addEventListener("click",()=>s(t,-1)),o.addEventListener("click",()=>s(t,1))})}function s(n,e){let t=parseInt(n.value);if(t=Math.max(1,t+e),n.value=t,n.closest(".table-content")){const c=n.closest("tr").dataset.productId;a(c,t)}}function T(n,e){fetch("/cart/add",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({product_id:n,quantity:e})}).then(t=>t.json()).then(t=>{l(t.message),m(t.cart_count)}).catch(t=>console.error("Ошибка:",t))}function a(n,e){fetch("/cart/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({product_id:n,quantity:e})}).then(t=>t.json()).then(t=>{p(t.total)}).catch(t=>console.error("Ошибка:",t))}function w(n){fetch("/cart/remove",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({product_id:n})}).then(e=>e.json()).then(e=>{const t=document.querySelector(`tr[data-product-id="${n}"]`);t&&t.remove(),p(e.total),m(e.cart_count),l(e.message),e.cart_count===0&&window.location.reload()}).catch(e=>console.error("Ошибка:",e))}function l(n){const e=document.createElement("div");e.className="cart-notification",e.textContent=n,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function m(n){const e=document.querySelector(".cart-count");e&&(e.textContent=n)}function p(n){const e=document.querySelector(".product-subtotal");e&&(e.textContent=`${n} ₽`)}document.addEventListener("DOMContentLoaded",function(){const n=window.location.origin;document.querySelectorAll(".quickview").forEach(t=>{t.addEventListener("click",function(){document.querySelector(".cart-plus-minus-box").value=1;const c=this.getAttribute("data-id");document.querySelector("#modalProduct .modal-body h2").innerText="Загрузка...",document.querySelector("#modalProduct .modal-body .new-price").innerText="",document.querySelector("#modalProduct .modal-body .swiper-container .swiper-wrapper").innerHTML="",fetch(`${n}/api/product/${c}`).then(o=>{if(!o.ok)throw new Error("Ошибка загрузки данных");return o.json()}).then(o=>{const r=o.title||"---",i=o.price||"---",d=o.sku||"---",y=o.unit==="шт"?"<span>шт.</span>":"<span>м<sup>2</sup></span>",f=o.collection?o.collection.title:"---",h=o.brand?o.brand.title:"---",q=o.description||"---",S=o.images&&o.images.length>0?o.images:[{title:null}],b=document.querySelector("#modalProduct .pro-details-cart .add-cart");document.querySelector("#modalProduct .modal-body h2").innerText=r,document.querySelector("#modalProduct .modal-body .new-price").innerText=`${i} ₽`,document.querySelector("#modalProduct .modal-body .new-sku").innerText=d,document.querySelector("#modalProduct .modal-body .new-unit").innerHTML=y,document.querySelector("#modalProduct .modal-body .new-collection").innerText=f,document.querySelector("#modalProduct .modal-body .new-brand").innerText=h,document.querySelector("#modalProduct .modal-body .new-description").innerText=q,b.setAttribute("data-product-id",o.id),document.querySelector("#modalProduct .modal-body .swiper-container .swiper-wrapper").innerHTML=S.map(u=>`<div class="swiper-slide" style="border: none;"><img class="img-responsive m-auto" src="${u.title?`${n}/storage/images/${u.title}`:`${n}/assets/images/stock/stock-image.png`}" alt="${u.title?u.title:"Изображение по умолчанию"}"></div>`).join("")}).catch(o=>{console.error(o),document.querySelector("#modalProduct .modal-body h2").innerText="Ошибка загрузки данных"})})})});
